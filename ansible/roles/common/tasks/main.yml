---
# Common system dependencies for all distros

- name: Check for NVIDIA GPU
  ansible.builtin.stat:
    path: /proc/driver/nvidia/version
  register: nvidia_check
  changed_when: false

- name: Install system dependencies (Debian/Ubuntu)
  apt:
    name: "{{ debian_packages }}"
    state: present
    update_cache: yes
  when: ansible_facts['os_family'] == "Debian"

- name: Install system dependencies (Fedora/Nobara/RHEL/AlmaLinux/Rocky Linux)
  dnf:
    name: "{{ fedora_packages }}"
    state: present
  when: ansible_facts['distribution'] in ["Fedora", "Nobara", "RedHat", "AlmaLinux", "Rocky"]

- name: Install system dependencies (Arch)
  pacman:
    name: "{{ arch_packages }}"
    state: present
    update_cache: yes
  when: ansible_facts['os_family'] == "Archlinux"

- name: Install system dependencies (openSUSE)
  zypper:
    name: "{{ suse_packages }}"
    state: present
  when: ansible_facts['os_family'] == "Suse"
